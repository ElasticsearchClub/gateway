path.data: data
path.logs: log

entry:
  - name: my_es_entry
    enabled: true
    router: my_router
    max_concurrency: 200000
    network:
      binding: 0.0.0.0:8000
#    tls:
#      enabled: true

flow:
  - name: cache_first
    filter: #comment out any filter sections, like you don't need cache or rate-limiter
      - get_cache:
          pass_patterns:
            - _cat
      - elasticsearch:
          elasticsearch: dev  #elasticsearch configure reference name
          max_connection_per_host: 1000 #max tcp connection to upstream, default for all nodes
          max_response_size: -1 #default for all nodes
          balancer: weight
          refresh: # refresh upstream nodes list, need to enable this feature to use elasticsearch nodes auto discovery
            enabled: true
            interval: 10s
          filter:
            roles:
              exclude:
                - master
      - set_cache:
          cache_ttl: 10s
  - name: online_indexing_merge
    filter:
      - bulk_reshuffle:
          elasticsearch: dev
          level: node
          mode: sync
      - elasticsearch: #catchup all left requests
          elasticsearch: dev
          max_connection_per_host: 1000
          refresh:
            enabled: true
            interval: 10s
router:
  - name: my_router
    default_flow: cache_first
    rules:
      - method:
          - PUT
          - POST
        pattern:
          - "/_bulk"
          - "/{index_name}/_bulk"
        flow:
          - online_indexing_merge

elasticsearch:
- name: dev
  enabled: true
  endpoint: http://192.168.3.188:9206
  traffic_control:
    max_bps_per_node: -1
    max_qps_per_node: 300000
  basic_auth:
    username: test
    password: testtest
  discovery:
    enabled: true
    refresh:
      enabled: true
      interval: 10s
