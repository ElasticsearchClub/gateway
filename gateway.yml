path.data: data
path.logs: log

entry:
  - name: es_gateway
    enabled: true
    router: default
    network:
      binding: 0.0.0.0:8000
      reuse_port: true

flow:
  - name: not_found
    filter:
      - name: not_found
        type: echo
        parameters:
          str: "404 not found\n"
          repeat: 1
  - name: cache_first
    filter:
#      - name: get_cache_1
#        type: get_cache
#        parameters:
#          pass_patterns: ["_cat","scroll", "scroll_id","_refresh","_cluster","_ccr","_count","_flush","_ilm","_ingest","_license","_migration","_ml","_rollup","_data_stream","_open", "_close"]
#          max_response_size: 102400
#          hash_factor:
#            header:
#              - "*"
#            path: true
#            query_args:
#              - id
#          must_cache:
#            method:
#              - GET
#            path:
#              - _search
#              - _async_search
      - name: rate_limit_1
        type: rate_limit
        parameters:
          message: "Hey, You just reached our request limit!"
          rules:
            - pattern: "/(?P<index_name>medcl)/_search" #use index name
              max_qps: 3
              group: index_name
            - pattern: "/(?P<index_name>.*?)/_search" #use regex pattern to match index
              max_qps: 100
              group: index_name
      - name: elasticsearch_1
        type: elasticsearch
        parameters:
          elasticsearch: default
          max_connection: 1000 #default for nodes
          max_response_size: 104857600 #default for nodes
          balancer: weight
          weight:
            - host: 192.168.3.1:9200
              weight: 10
            - host: 192.168.3.2:9200
              weight: 20
          discovery:
            enabled: true
      - name: set_cache_1
        type: set_cache


router:
  - name: default
    default_flow: cache_first
    rules:
      - id: 1
        method:
          - "*"
        pattern:
          - /
        priority: 1
        flow:
          - cache_first

elasticsearch:
- name: default
  enabled: true
  endpoint: http://localhost:9200
  version: 7.6.0
  index_prefix: proxy-
  basic_auth:
    username: elastic
    password: pass

modules:
- name: elastic
  elasticsearch: default
  enabled: true
